?Year
??Year
d <- as.Date("2021-03-01")
Year(d)
year(d)
library(lubridate)
year(d)
Year(d)
month(d)
today <- format(Sys.Date(), "%m_%Y")
library(SafeGraphR)
install.pacakges(SafeGraphR)
# install.packages('remotes')
remotes::install_github('SafeGraphInc/SafeGraphR')
head(cbg_pop)
?cbg_pop
library(SafeGraphR)
head(cbg_pop)
head(cbg_pop)
type(cbg_pop$poi_cbg)
typeof(cbg_pop$poi_cbg)
head(cbg_pop)
typeof(cbg_pop)
typeof(cbg_pop$poi_cbg)
#### Read and clean Income & Population ----
income <- read.csv(paste0(getwd(), "/heatwaves_manual/safegraph_open_census_data/data/cbg_b19.csv"), stringsAsFactors = F, header = T)
#### Read and clean Income & Population ----
income <- read.csv(paste0(getwd(), "/heatwaves_manual/safegraph_open_census_data/data/cbg_b19.csv"), stringsAsFactors = F, header = T)
ifelse(dir.exists("~/Box Sync/heatwave_covid"),
setwd("~/Box Sync/heatwave_covid"),
setwd("/oak/stanford/groups/omramom/group_members/aminaly/heatwave_covid"))
ifelse(dir.exists("~/Box Sync/heatwave_covid"),
setwd("~/Box Sync/heatwave_covid"),
setwd("/oak/stanford/groups/omramom/group_members/aminaly/heatwave_covid"))
#### Read and clean Income & Population ----
income <- read.csv(paste0(getwd(), "/heatwaves_manual/safegraph_open_census_data/data/cbg_b19.csv"), stringsAsFactors = F, header = T)
income <- na.omit(income %>% dplyr::select(census_block_group, 	median_income = B19013e1))
head(income)
income <- income %>% mutate("census_block_group" = ifelse(nchar(census_block_group) == 11,
paste0("0", census_block_group), census_block_group))
library(dplyr)
income <- income %>% mutate("census_block_group" = ifelse(nchar(census_block_group) == 11,
paste0("0", census_block_group), census_block_group))
income$fips <- substr(income$census_block_group, 1, 5)
head(income)
typeof(income$fips)
income <- income %>% mutate(income_group = ntile(median_income, 5)) %>% filter(fips %in% included_fips)
# FIPS codes we care about
included_fips <- c("06081", "06085", "06001", "06013","06075", "06087", "06041", "06097", "06055", "06095") #bay area
income <- income %>% mutate(income_group = ntile(median_income, 5)) %>% filter(fips %in% included_fips)
unique(nchar(income$fips))
head(income)
income$census_block_group <- as.character(income$census_block_group)
pops <- cbg_pop %>% mutate(census_block_group = as.character(poi_cbg)) %>%
mutate(census_block_group =  ifelse(nchar(census_block_group) == 11,
paste0("0", census_block_group), census_block_group)) %>%
select(census_block_group, unweighted_pop)
head(pops)
pops$fips <- str_sub(pops$census_block_group, 1,5)
library(tidyverse)
library(stringr)
pops$fips <- str_sub(pops$census_block_group, 1,5)
pops <- pops %>% filter(fips %in% included_fips)
head(pops)
pop_income <- left_join(income, pops, by = c("census_block_group", "fips"))
head(pop_income)
View(income)
View(income)
View(pop_income)
pop_income %>% filter(census_block_group == "060014001001")
View(pop_income)
head(income)
head(pop_income)
View(pop_income)
View(income)
View(pops)
View(pops)
View(pops)
