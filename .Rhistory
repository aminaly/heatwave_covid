data <- left_join(data, demo %>% select(census_block_group, fips, maxdemo), by = c("census_block_group", "fips"))
data_summer <- data %>% filter(month %in% c(5:9)) # may - sept
data_summer <- data_summer %>% filter(!is.na(maxdemo))
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days 2018") +
facet_wrap( ~ hot, nrow = 2) +
theme_bw()
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days 2018") +
facet_wrap( ~ hot) +
theme_bw()
pdf(paste0("./visuals/pub_figures/densityplots_mobilitythroughyears", td, ".pdf"))
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days 2018") +
facet_wrap( ~ hot) +
theme_bw()
## white
ggplot(data = data_summer %>% filter(maxdemo == "p_white" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days 2019") +
facet_wrap( ~ hot) +
theme_bw()
## asian
ggplot(data = data_summer %>% filter(maxdemo == "p_asian" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days 2020") +
facet_wrap( ~ hot) +
theme_bw()
## latinx
ggplot(data = data_summer %>% filter(maxdemo == "p_latinx" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days 2021") +
facet_wrap( ~ hot) +
theme_bw()
dev.off()
pdf(paste0("./visuals/pub_figures/densityplots_mobilitythroughyears", td, ".pdf"))
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Black CBG") +
facet_wrap( ~ hot) +
theme_bw()
## white
ggplot(data = data_summer %>% filter(maxdemo == "p_white" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj White CBG") +
facet_wrap( ~ hot) +
theme_bw()
## asian
ggplot(data = data_summer %>% filter(maxdemo == "p_asian" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Asian CBG") +
facet_wrap( ~ hot) +
theme_bw()
## latinx
ggplot(data = data_summer %>% filter(maxdemo == "p_latinx" & visitors_percap > quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Latinx CBG") +
facet_wrap( ~ hot) +
theme_bw()
dev.off()
pdf(paste0("./visuals/pub_figures/densityplots_mobilitythroughyears", td, ".pdf"))
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Black CBG") +
facet_wrap( ~ hot) +
theme_bw()
## white
ggplot(data = data_summer %>% filter(maxdemo == "p_white" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj White CBG") +
facet_wrap( ~ hot) +
theme_bw()
## asian
ggplot(data = data_summer %>% filter(maxdemo == "p_asian" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Asian CBG") +
facet_wrap( ~ hot) +
theme_bw()
## latinx
ggplot(data = data_summer %>% filter(maxdemo == "p_latinx" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Latinx CBG") +
facet_wrap( ~ hot) +
theme_bw()
dev.off()
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Black CBG") +
facet_wrap( ~ hot) +
scale_fill_brewer(palette = "Set1") +
theme_bw()
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Black CBG") +
facet_wrap( ~ hot) +
scale_color_brewer(palette = "Set1") +
theme_bw()
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year), stat = "identity") +
ggtitle("Density of Mobility Hot vs Regular Days Maj Black CBG") +
facet_wrap( ~ hot) +
theme_bw()
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Black CBG") +
facet_wrap( ~ hot) +
theme_bw()
data_summer <- data_summer %>% filter(!is.na(maxdemo)) %>% mutate(year = as.factor(year))
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Black CBG") +
facet_wrap( ~ hot) +
theme_bw()
pdf(paste0("./visuals/pub_figures/densityplots_mobilitythroughyears", td, ".pdf"))
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Black CBG") +
facet_wrap( ~ hot) +
theme_bw()
## white
ggplot(data = data_summer %>% filter(maxdemo == "p_white" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj White CBG") +
facet_wrap( ~ hot) +
theme_bw()
## asian
ggplot(data = data_summer %>% filter(maxdemo == "p_asian" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Asian CBG") +
facet_wrap( ~ hot) +
theme_bw()
## latinx
ggplot(data = data_summer %>% filter(maxdemo == "p_latinx" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_density(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Latinx CBG") +
facet_wrap( ~ hot) +
theme_bw()
dev.off()
sig_results <- c()
for(i in unique(data_summer$maxdemo)) {
for(y in 2018:2021) {
d_hot <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Hot Day" & visitors_percap > quantile(visitors_percap, .95))
d_reg <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot = "Regular Day" & visitors_percap > quantile(visitors_percap, .95))
ks_h <- ks.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))
w_h <- wilcox.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))
sig_results <- rbind(sig_results,
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "KS",statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "Wilcox",statistic = w_h$statistic, pval = w_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
ks_r <- ks.test(d_reg %>% filter(year == y) %>% pull(visitors_percap),
d_reg %>% filter(year == 2021) %>% pull(visitors_percap))
w_r <- wilcox.test(d_reg %>% filter(year == y) %>% pull(visitors_percap),
d_reg %>% filter(year == 2021) %>% pull(visitors_percap))
sig_results <- rbind(sig_results,
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "KS",statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "Wilcox",statistic = w_h$statistic, pval = w_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
}
sig_results <- c()
for(i in unique(data_summer$maxdemo)) {
for(y in 2018:2021) {
d_hot <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Hot Day" & visitors_percap > quantile(visitors_percap, .95))
d_reg <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot = "Regular Day" & visitors_percap > quantile(visitors_percap, .95))
ks_h <- ks.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))
w_h <- wilcox.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))
sig_results <- rbind(sig_results,
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "KS",statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "Wilcox",statistic = w_h$statistic, pval = w_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
ks_r <- ks.test(d_reg %>% filter(year == y) %>% pull(visitors_percap),
d_reg %>% filter(year == 2021) %>% pull(visitors_percap))
w_r <- wilcox.test(d_reg %>% filter(year == y) %>% pull(visitors_percap),
d_reg %>% filter(year == 2021) %>% pull(visitors_percap))
sig_results <- rbind(sig_results,
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "KS",statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "Wilcox",statistic = w_h$statistic, pval = w_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
}
for(i in unique(data_summer$maxdemo)) {
for(y in 2018:2021) {
d_hot <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Hot Day" & visitors_percap > quantile(visitors_percap, .95))
d_reg <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Regular Day" & visitors_percap > quantile(visitors_percap, .95))
ks_h <- ks.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))
w_h <- wilcox.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))
sig_results <- rbind(sig_results,
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "KS",statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "Wilcox",statistic = w_h$statistic, pval = w_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
ks_r <- ks.test(d_reg %>% filter(year == y) %>% pull(visitors_percap),
d_reg %>% filter(year == 2021) %>% pull(visitors_percap))
w_r <- wilcox.test(d_reg %>% filter(year == y) %>% pull(visitors_percap),
d_reg %>% filter(year == 2021) %>% pull(visitors_percap))
sig_results <- rbind(sig_results,
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "KS",statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "Wilcox",statistic = w_h$statistic, pval = w_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
}
for(i in unique(data_summer$maxdemo)) {
for(y in 2018:2021) {
d_hot <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Hot Day" & visitors_percap > quantile(visitors_percap, .95))
d_reg <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Regular Day" & visitors_percap > quantile(visitors_percap, .95))
ks_h <- tryCatch({ks.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
w_h <- tryCatch({wilcox.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
sig_results <- rbind(sig_results,
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "KS",statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "Wilcox",statistic = w_h$statistic, pval = w_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Hot Days",
test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
ks_r <- tryCatch({ks.test(d_reg %>% filter(year == y) %>% pull(visitors_percap),
d_reg %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
w_r <- tryCatch({wilcox.test(d_reg %>% filter(year == y) %>% pull(visitors_percap),
d_reg %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
sig_results <- rbind(sig_results,
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "KS",statistic = ks_h$statistic, pval = ks_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "Wilcox",statistic = w_h$statistic, pval = w_h$p.value),
c(maxdemo = i, year = y, percentile_visitors = "95th", Hot = "Regular Days",
test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
}
for(i in unique(data_summer$maxdemo)) {
for(y in 2018:2021) {
d_hot <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Hot Day" &
visitors_percap > quantile(visitors_percap, .95))
## KS
ks_h <- tryCatch({ks.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(ks_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value))
}
## wilcox
w_h <- tryCatch({wilcox.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(w_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
}
}
sig_results <- c()
for(i in unique(data_summer$maxdemo)) {
for(y in 2018:2021) {
d_hot <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Hot Day" &
visitors_percap > quantile(visitors_percap, .95))
## KS
ks_h <- tryCatch({ks.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(ks_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value))
}
## wilcox
w_h <- tryCatch({wilcox.test(d_hot %>% filter(year == y) %>% pull(visitors_percap),
d_hot %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(w_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
}
}
write.csv(sig_results, "calculated/sigresults.csv")
sig_results <- c()
for(i in unique(data_summer$maxdemo)) {
for(y in 2018:2021) {
d <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Hot Day" &
visitors_percap > quantile(visitors_percap, .95))
## KS
ks_h <- tryCatch({ks.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(ks_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value))
}
## wilcox
w_h <- tryCatch({wilcox.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(w_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
d <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Regular Day" &
visitors_percap > quantile(visitors_percap, .95))
## KS
ks_h <- tryCatch({ks.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(ks_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value))
}
## wilcox
w_h <- tryCatch({wilcox.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(w_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
}
}
sig_results <- c()
for(i in unique(data_summer$maxdemo)) {
for(y in 2018:2021) {
d <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Hot Day" &
visitors_percap < quantile(visitors_percap, .95))
## KS
ks_h <- tryCatch({ks.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(ks_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value))
}
## wilcox
w_h <- tryCatch({wilcox.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(w_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
d <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Regular Day" &
visitors_percap < quantile(visitors_percap, .95))
## KS
ks_h <- tryCatch({ks.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(ks_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value))
}
## wilcox
w_h <- tryCatch({wilcox.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(w_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = NA, pval = NA))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value))
}
}
}
write.csv(sig_results, "calculated/sigresults.csv")
sig_results <- c()
for(i in unique(data_summer$maxdemo)) {
for(y in 2018:2021) {
d <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Hot Day" &
visitors_percap < quantile(visitors_percap, .95))
## KS
ks_h <- tryCatch({ks.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(ks_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = NA, pval = NA, temp = "Hot"))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value , temp = "Hot"))
}
## wilcox
w_h <- tryCatch({wilcox.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(w_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = NA, pval = NA, temp = "Hot"))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value, temp = "Hot"))
}
d <- data_summer %>% filter(year %in% c(2021, y), maxdemo == i & hot == "Regular Day" &
visitors_percap < quantile(visitors_percap, .95))
## KS
ks_h <- tryCatch({ks.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(ks_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = NA, pval = NA, temp = "Regular"))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "KS", statistic = ks_h$statistic, pval = ks_h$p.value, temp = "Regular"))
}
## wilcox
w_h <- tryCatch({wilcox.test(d %>% filter(year == y) %>% pull(visitors_percap),
d %>% filter(year == 2021) %>% pull(visitors_percap))}, error=function(e) {return(NA)})
if(is.na(w_h)) {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = NA, pval = NA, temp = "Regular"))
} else {
sig_results <- rbind(sig_results, c(maxdemo = i, year = y, test = "Wilcox", statistic = w_h$statistic, pval = w_h$p.value, temp = "Regular"))
}
}
}
write.csv(sig_results, "calculated/sigresults.csv")
pdf(paste0("./visuals/pub_figures/boxplots_mobilitythroughyears", td, ".pdf"))
## black
ggplot(data = data_summer %>% filter(maxdemo == "p_black" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_boxplot(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Black CBG") +
facet_wrap( ~ hot) +
theme_bw()
## white
ggplot(data = data_summer %>% filter(maxdemo == "p_white" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_boxplot(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj White CBG") +
facet_wrap( ~ hot) +
theme_bw()
## asian
ggplot(data = data_summer %>% filter(maxdemo == "p_asian" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_boxplot(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Asian CBG") +
facet_wrap( ~ hot) +
theme_bw()
## latinx
ggplot(data = data_summer %>% filter(maxdemo == "p_latinx" & visitors_percap < quantile(visitors_percap, .95)),
aes(x = visitors_percap, group=year)) +
geom_boxplot(aes(color = year)) +
ggtitle("Density of Mobility Hot vs Regular Days Maj Latinx CBG") +
facet_wrap( ~ hot) +
theme_bw()
dev.off()
arg <- 2
unique(data$maxdemo)[arg]
a <- data %>% filter(maxdemo == )
data %>% group_by(maxdemo) %>% summarize(counties = paste(fips))
data %>% group_by(maxdemo) %>% summarize(counties = unique(fips))
View(data %>% group_by(maxdemo) %>% summarize(counties = unique(fips)))
